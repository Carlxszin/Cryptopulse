<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CH Celulares | Especialista em Apple e Smartphones</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: { 500: '#3B82F6', 600: '#2563EB' },
                        dark: { 900: '#050505', 800: '#0f0f0f', 700: '#1a1a1a', 600: '#262626' },
                        success: '#10B981',
                        warning: '#F59E0B'
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'] }
                }
            }
        }
    </script>
    
    <!-- √çcones e Fontes -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #050505; color: #f3f4f6; }
        
        /* Elementos de Vidro e UI */
        .glass { background: rgba(15, 15, 15, 0.85); backdrop-filter: blur(16px); border-bottom: 1px solid rgba(255,255,255,0.05); }
        .card-glass { background: #121212; border: 1px solid #262626; }
        
        /* Badges de Condi√ß√£o */
        .badge-novo { background: #10B981; color: white; }
        .badge-vitrine { background: #3B82F6; color: white; }
        .badge-usado { background: #F59E0B; color: black; }

        /* Anima√ß√µes */
        .hover-lift { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .hover-lift:hover { transform: translateY(-4px); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #050505; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 3px; }

        /* Carrinho Lateral */
        #cart-drawer { transition: transform 0.3s ease-in-out; }
        .drawer-open { transform: translateX(0) !important; }
        .drawer-closed { transform: translateX(100%) !important; }

        .loader { border-top-color: #3B82F6; animation: spinner 1s linear infinite; }
        @keyframes spinner { to { transform: rotate(360deg); } }
    </style>
</head>
<body class="antialiased min-h-screen flex flex-col overflow-x-hidden">

    <!-- Navega√ß√£o -->
    <nav class="glass fixed w-full top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 h-16 flex justify-between items-center">
            <!-- Logo -->
            <div class="flex items-center cursor-pointer gap-2" onclick="app.showHome()">
                <div class="bg-brand-600/20 p-2 rounded-lg">
                    <i class="fa-solid fa-mobile-screen text-brand-500"></i>
                </div>
                <div>
                    <h1 class="font-bold text-xl tracking-tight leading-none text-white">CH <span class="text-brand-500">Celulares</span></h1>
                    <span class="text-[10px] text-gray-400 uppercase tracking-widest">Premium Store</span>
                </div>
            </div>

            <!-- A√ß√µes -->
            <div class="flex items-center gap-4">
                <!-- Bot√£o Carrinho -->
                <button onclick="app.toggleCart()" class="relative p-2 text-gray-300 hover:text-white transition">
                    <i class="fa-solid fa-cart-shopping text-xl"></i>
                    <span id="cart-count" class="absolute -top-1 -right-1 bg-brand-600 text-white text-[10px] font-bold h-5 w-5 flex items-center justify-center rounded-full hidden">0</span>
                </button>

                <!-- Menu Admin (S√≥ aparece se logado) -->
                <button onclick="app.toggleAdminModal()" id="adminBtn" class="text-xs font-medium text-gray-500 hover:text-white flex items-center gap-1 border border-white/10 px-3 py-1.5 rounded-full">
                    <i class="fa-solid fa-lock"></i> <span class="hidden sm:inline">Admin</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Drawer do Carrinho -->
    <div id="cart-overlay" onclick="app.toggleCart()" class="fixed inset-0 bg-black/60 z-50 hidden backdrop-blur-sm"></div>
    <div id="cart-drawer" class="fixed top-0 right-0 h-full w-full max-w-md bg-dark-800 z-[60] shadow-2xl drawer-closed border-l border-white/10 flex flex-col">
        <div class="p-5 border-b border-white/10 flex justify-between items-center bg-dark-900">
            <h2 class="text-lg font-bold"><i class="fa-solid fa-bag-shopping mr-2 text-brand-500"></i>Seu Carrinho</h2>
            <button onclick="app.toggleCart()" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
        </div>
        
        <div id="cart-items" class="flex-1 overflow-y-auto p-5 space-y-4">
            <!-- Itens do carrinho via JS -->
            <div class="text-center py-10 text-gray-500">
                <i class="fa-solid fa-cart-arrow-down text-4xl mb-3 opacity-30"></i>
                <p>Seu carrinho est√° vazio.</p>
            </div>
        </div>

        <div class="p-5 bg-dark-900 border-t border-white/10">
            <div class="flex justify-between mb-4 text-sm">
                <span class="text-gray-400">Subtotal</span>
                <span id="cart-total" class="font-bold text-white">R$ 0,00</span>
            </div>
            <button onclick="app.goToCheckout()" class="w-full bg-brand-600 hover:bg-brand-500 text-white py-3 rounded-lg font-bold transition flex items-center justify-center gap-2">
                Finalizar Compra <i class="fa-solid fa-arrow-right"></i>
            </button>
        </div>
    </div>

    <!-- Conte√∫do Principal -->
    <div id="app-container" class="pt-16 flex-grow">
        
        <!-- Hero: Troca e Confian√ßa -->
        <div class="bg-gradient-to-b from-dark-800 to-dark-900 border-b border-white/5 py-12">
            <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-2 gap-8 items-center">
                <div>
                    <span class="inline-block px-3 py-1 bg-brand-500/10 text-brand-400 rounded-full text-xs font-bold mb-4 border border-brand-500/20">üöÄ COMPRA ‚Ä¢ VENDA ‚Ä¢ TROCA</span>
                    <h1 class="text-4xl md:text-5xl font-extrabold text-white mb-4 leading-tight">
                        Seu smartphone novo <br> com <span class="text-brand-500">proced√™ncia garantida</span>.
                    </h1>
                    <p class="text-gray-400 mb-6 text-lg">Aceitamos seu iPhone usado como parte do pagamento. Garantia de 90 dias em todos os aparelhos.</p>
                    <div class="flex gap-3">
                        <a href="#produtos" class="bg-brand-600 text-white px-6 py-3 rounded-lg font-bold hover:bg-brand-500 transition">Ver Estoque</a>
                        <button onclick="app.contactWhatsApp('Avalia√ß√£o')" class="bg-dark-700 text-white px-6 py-3 rounded-lg font-bold hover:bg-dark-600 transition border border-white/10">Avaliar meu Usado</button>
                    </div>
                </div>
                
                <!-- Cards de Confian√ßa -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="card-glass p-4 rounded-xl">
                        <i class="fa-solid fa-shield-halved text-2xl text-green-500 mb-2"></i>
                        <h3 class="font-bold text-sm">Garantia Real</h3>
                        <p class="text-xs text-gray-500">90 dias com suporte direto.</p>
                    </div>
                    <div class="card-glass p-4 rounded-xl">
                        <i class="fa-solid fa-file-invoice text-2xl text-blue-500 mb-2"></i>
                        <h3 class="font-bold text-sm">Transpar√™ncia</h3>
                        <p class="text-xs text-gray-500">Proced√™ncia verificada.</p>
                    </div>
                    <div class="card-glass p-4 rounded-xl">
                        <i class="fa-brands fa-pix text-2xl text-teal-400 mb-2"></i>
                        <h3 class="font-bold text-sm">Desconto no Pix</h3>
                        <p class="text-xs text-gray-500">5% OFF √† vista.</p>
                    </div>
                    <div class="card-glass p-4 rounded-xl">
                        <i class="fa-solid fa-truck-fast text-2xl text-orange-400 mb-2"></i>
                        <h3 class="font-bold text-sm">Entrega R√°pida</h3>
                        <p class="text-xs text-gray-500">Motoboy ou Correios.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filtros e Busca -->
        <div class="sticky top-16 bg-dark-900/90 backdrop-blur-md z-30 border-b border-white/5 py-3">
            <div class="max-w-7xl mx-auto px-4 flex flex-col sm:flex-row gap-4 justify-between items-center">
                <div class="flex gap-2 overflow-x-auto w-full sm:w-auto pb-2 sm:pb-0 no-scrollbar">
                    <button onclick="app.filterProducts('all')" class="px-4 py-1.5 rounded-full text-sm font-medium bg-white text-black hover:bg-gray-200 transition whitespace-nowrap">Todos</button>
                    <button onclick="app.filterProducts('iPhone')" class="px-4 py-1.5 rounded-full text-sm font-medium bg-dark-700 hover:bg-dark-600 transition whitespace-nowrap border border-white/10">iPhones</button>
                    <button onclick="app.filterProducts('Android')" class="px-4 py-1.5 rounded-full text-sm font-medium bg-dark-700 hover:bg-dark-600 transition whitespace-nowrap border border-white/10">Android</button>
                    <button onclick="app.filterProducts('Acessorio')" class="px-4 py-1.5 rounded-full text-sm font-medium bg-dark-700 hover:bg-dark-600 transition whitespace-nowrap border border-white/10">Acess√≥rios</button>
                </div>
                <div class="relative w-full sm:w-64">
                    <i class="fa-solid fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-xs"></i>
                    <input type="text" id="search-input" oninput="app.searchProducts(this.value)" placeholder="Buscar modelo..." class="w-full bg-dark-800 border border-dark-600 rounded-full pl-9 pr-4 py-1.5 text-sm focus:border-brand-500 focus:outline-none transition text-white">
                </div>
            </div>
        </div>

        <!-- Lista de Produtos -->
        <div id="produtos" class="max-w-7xl mx-auto px-4 py-12 min-h-[50vh]">
            <div id="loading-spinner" class="flex flex-col items-center justify-center py-20">
                <div class="loader ease-linear rounded-full border-4 border-t-4 border-dark-600 h-10 w-10 mb-4"></div>
                <p class="text-gray-500 text-sm">Carregando estoque...</p>
            </div>
            <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"></div>
        </div>

        <!-- Se√ß√£o de Servi√ßos -->
        <div class="bg-dark-800 border-y border-white/5 py-16">
            <div class="max-w-7xl mx-auto px-4 text-center">
                <h2 class="text-2xl font-bold mb-8">Nossos Servi√ßos</h2>
                <div class="grid md:grid-cols-3 gap-6">
                    <div class="p-6 rounded-xl bg-dark-700 border border-white/5 hover:border-brand-500/30 transition">
                        <div class="w-12 h-12 rounded-full bg-blue-500/10 flex items-center justify-center mx-auto mb-4 text-blue-400 text-xl"><i class="fa-solid fa-screwdriver-wrench"></i></div>
                        <h3 class="font-bold mb-2">Assist√™ncia T√©cnica</h3>
                        <p class="text-sm text-gray-400">Troca de tela, bateria e reparos avan√ßados com garantia.</p>
                    </div>
                    <div class="p-6 rounded-xl bg-dark-700 border border-white/5 hover:border-brand-500/30 transition">
                        <div class="w-12 h-12 rounded-full bg-green-500/10 flex items-center justify-center mx-auto mb-4 text-green-400 text-xl"><i class="fa-solid fa-rotate"></i></div>
                        <h3 class="font-bold mb-2">Trade-In</h3>
                        <p class="text-sm text-gray-400">Seu usado vale desconto na compra de um novo.</p>
                    </div>
                    <div class="p-6 rounded-xl bg-dark-700 border border-white/5 hover:border-brand-500/30 transition">
                        <div class="w-12 h-12 rounded-full bg-purple-500/10 flex items-center justify-center mx-auto mb-4 text-purple-400 text-xl"><i class="fa-solid fa-headset"></i></div>
                        <h3 class="font-bold mb-2">Suporte P√≥s-Venda</h3>
                        <p class="text-sm text-gray-400">Ajuda para configurar seu aparelho e transferir dados.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="bg-dark-900 border-t border-white/5 pt-16 pb-8">
            <div class="max-w-7xl mx-auto px-4 grid md:grid-cols-4 gap-8 mb-12">
                <div class="col-span-1 md:col-span-2">
                    <h2 class="font-bold text-xl mb-4 text-white">CH Celulares</h2>
                    <p class="text-gray-500 text-sm max-w-xs mb-4">Sua loja de confian√ßa para produtos Apple e smartphones premium. Qualidade, pre√ßo justo e transpar√™ncia.</p>
                    <div class="flex gap-4">
                        <a href="#" class="text-gray-400 hover:text-brand-500"><i class="fa-brands fa-instagram text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-brand-500"><i class="fa-brands fa-facebook text-xl"></i></a>
                    </div>
                </div>
                <div>
                    <h3 class="font-bold text-white mb-4">Informa√ß√µes</h3>
                    <ul class="space-y-2 text-sm text-gray-500">
                        <li><a href="#" class="hover:text-brand-500">Pol√≠tica de Garantia</a></li>
                        <li><a href="#" class="hover:text-brand-500">Trocas e Devolu√ß√µes</a></li>
                        <li><a href="#" class="hover:text-brand-500">Sobre N√≥s</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-bold text-white mb-4">Contato</h3>
                    <ul class="space-y-2 text-sm text-gray-500">
                        <li><i class="fa-brands fa-whatsapp mr-2"></i> (11) 99999-9999</li>
                        <li><i class="fa-solid fa-location-dot mr-2"></i> Rua Exemplo, 123 - Centro</li>
                        <li><i class="fa-solid fa-id-card mr-2"></i> CNPJ: 00.000.000/0001-00</li>
                    </ul>
                </div>
            </div>
            <div class="max-w-7xl mx-auto px-4 border-t border-white/5 pt-8 text-center text-xs text-gray-600">
                <p>&copy; 2024 CH Celulares. Todos os direitos reservados.</p>
            </div>
        </footer>
    </div>

    <!-- MODAL QUICK VIEW (DETALHES DO PRODUTO) -->
    <div id="quickview-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm p-4">
        <div class="bg-dark-800 rounded-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto border border-white/10 relative flex flex-col md:flex-row shadow-2xl">
            <button onclick="app.closeModal('quickview-modal')" class="absolute top-4 right-4 z-10 text-gray-400 hover:text-white bg-black/50 rounded-full w-8 h-8 flex items-center justify-center transition border border-white/10"><i class="fa-solid fa-xmark"></i></button>
            
            <!-- Imagem Ampliada -->
            <div class="w-full md:w-1/2 bg-black/40 flex items-center justify-center p-8 relative min-h-[300px]">
                 <img id="qv-image" src="" class="max-h-[60vh] object-contain drop-shadow-2xl">
            </div>

            <!-- Detalhes -->
            <div class="w-full md:w-1/2 p-8 flex flex-col bg-dark-800">
                <div class="mb-4">
                    <span id="qv-badge" class="text-[10px] font-bold px-2 py-1 rounded-md uppercase tracking-wide shadow-sm mb-2 inline-block">Condi√ß√£o</span>
                    <h2 id="qv-name" class="text-3xl font-bold text-white leading-tight mb-2">Nome do Produto</h2>
                    <div class="flex flex-wrap items-center gap-4 text-sm text-gray-400 mt-2">
                        <span id="qv-storage" class="bg-dark-900 px-3 py-1 rounded-lg border border-white/5"></span>
                        <span id="qv-color" class="bg-dark-900 px-3 py-1 rounded-lg border border-white/5"></span>
                        <span id="qv-battery" class="bg-dark-900 px-3 py-1 rounded-lg border border-white/5"></span>
                    </div>
                </div>

                <div class="border-y border-white/5 py-6 my-2 flex-1 overflow-y-auto max-h-40 md:max-h-none">
                    <h4 class="text-xs font-bold text-gray-500 uppercase mb-2">Sobre este aparelho</h4>
                    <p id="qv-desc" class="text-gray-300 text-sm leading-relaxed whitespace-pre-wrap">Descri√ß√£o completa aqui...</p>
                </div>

                <div class="mt-auto pt-6">
                    <p class="text-xs text-gray-500 mb-1">Pre√ßo √† vista no Pix</p>
                    <div class="text-4xl font-bold text-brand-400 mb-6" id="qv-price">R$ 0,00</div>
                    
                    <button id="qv-btn-add" class="w-full bg-brand-600 hover:bg-brand-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-brand-900/20 flex items-center justify-center gap-3 transition transform active:scale-95 group">
                        <i class="fa-solid fa-cart-plus text-xl group-hover:scale-110 transition"></i> Adicionar ao Carrinho
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- MODAL DE CHECKOUT -->
    <div id="checkout-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="bg-dark-800 rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto border border-white/10">
            <div class="p-6 border-b border-white/10 flex justify-between items-center sticky top-0 bg-dark-800 z-10">
                <h3 class="text-xl font-bold text-white">Finalizar Pedido</h3>
                <button onclick="app.closeModal('checkout-modal')" class="text-gray-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <form id="checkout-form" class="p-6 space-y-6">
                <!-- Resumo -->
                <div class="bg-dark-700/50 p-4 rounded-xl border border-white/5">
                    <h4 class="font-bold text-sm mb-2 text-gray-300">Resumo da Compra</h4>
                    <div id="checkout-summary" class="text-sm text-gray-400 space-y-1 mb-3"></div>
                    <div class="flex justify-between font-bold text-white border-t border-white/10 pt-2">
                        <span>Total a Pagar:</span>
                        <span id="checkout-total" class="text-brand-400">R$ 0,00</span>
                    </div>
                </div>

                <!-- Dados Pessoais -->
                <div class="grid md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Seu Nome</label>
                        <input type="text" id="cust-name" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white focus:border-brand-500 outline-none" required>
                    </div>
                    <div>
                        <label class="block text-xs text-gray-500 mb-1">Telefone/WhatsApp</label>
                        <input type="tel" id="cust-phone" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white focus:border-brand-500 outline-none" required>
                    </div>
                </div>

                <!-- Entrega -->
                <div>
                    <label class="block text-xs text-gray-500 mb-2">Op√ß√£o de Entrega</label>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <label class="cursor-pointer">
                            <input type="radio" name="delivery" value="retirada" class="peer hidden" checked onchange="app.toggleAddress(false)">
                            <div class="p-4 rounded-xl bg-dark-900 border border-dark-600 peer-checked:border-brand-500 peer-checked:bg-brand-500/10 transition text-center">
                                <i class="fa-solid fa-store mb-2 text-xl"></i>
                                <div class="text-sm font-bold">Retirar na Loja</div>
                                <div class="text-xs text-gray-500">Gr√°tis</div>
                            </div>
                        </label>
                        <label class="cursor-pointer">
                            <input type="radio" name="delivery" value="entrega" class="peer hidden" onchange="app.toggleAddress(true)">
                            <div class="p-4 rounded-xl bg-dark-900 border border-dark-600 peer-checked:border-brand-500 peer-checked:bg-brand-500/10 transition text-center">
                                <i class="fa-solid fa-motorcycle mb-2 text-xl"></i>
                                <div class="text-sm font-bold">Entrega</div>
                                <div class="text-xs text-gray-500">A combinar</div>
                            </div>
                        </label>
                    </div>

                    <div id="address-fields" class="hidden space-y-4 border-l-2 border-dark-600 pl-4">
                        <input type="text" id="cust-address" placeholder="Endere√ßo Completo (Rua, N√∫mero, Bairro)" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white focus:border-brand-500 outline-none">
                        <input type="text" id="cust-city" placeholder="Cidade" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white focus:border-brand-500 outline-none">
                    </div>
                </div>

                <!-- Pagamento -->
                <div>
                    <label class="block text-xs text-gray-500 mb-2">Forma de Pagamento</label>
                    <select id="cust-payment" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white focus:border-brand-500 outline-none">
                        <option value="Pix">Pix (5% de Desconto)</option>
                        <option value="Cart√£o de Cr√©dito">Cart√£o de Cr√©dito (at√© 12x)</option>
                        <option value="Dinheiro">Dinheiro (Na retirada)</option>
                    </select>
                </div>

                <button type="submit" class="w-full bg-green-600 hover:bg-green-500 text-white py-4 rounded-xl font-bold text-lg shadow-lg flex items-center justify-center gap-2 transition transform active:scale-95">
                    <i class="fa-brands fa-whatsapp text-2xl"></i> Enviar Pedido
                </button>
                <p class="text-center text-xs text-gray-500">Voc√™ ser√° redirecionado para o WhatsApp para confirmar.</p>
            </form>
        </div>
    </div>

    <!-- Admin: Pain√©is (Login e CRUD) -->
    <div id="login-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm p-4">
        <div class="bg-dark-800 rounded-2xl p-8 max-w-sm w-full border border-white/10">
            <div class="flex justify-between mb-6">
                <h3 class="text-xl font-bold">Admin Login</h3>
                <button onclick="app.closeModal('login-modal')" class="text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form id="login-form" class="space-y-4">
                <input type="email" id="email" placeholder="Email" class="w-full bg-dark-900 p-3 rounded-lg border border-dark-600 text-white" required>
                <input type="password" id="password" placeholder="Senha" class="w-full bg-dark-900 p-3 rounded-lg border border-dark-600 text-white" required>
                <p id="login-error" class="text-red-500 text-xs hidden"></p>
                <button type="submit" class="w-full bg-brand-600 text-white py-3 rounded-lg font-bold">Entrar</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard Completo -->
    <div id="admin-panel" class="fixed inset-0 z-[60] hidden bg-dark-900 overflow-y-auto">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl font-bold">Painel de Controle</h2>
                <button onclick="app.hideAdminPanel()" class="text-gray-400 hover:text-white flex gap-2 items-center"><i class="fa-solid fa-arrow-left"></i> Voltar</button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                <div class="bg-dark-800 p-6 rounded-xl border border-white/5">
                    <h3 class="text-gray-400 text-sm">Total Produtos</h3>
                    <p class="text-2xl font-bold text-white" id="admin-total-prods">0</p>
                </div>
                <!-- Bot√µes de A√ß√£o -->
                <button onclick="app.showAddProductModal()" class="bg-green-600 hover:bg-green-500 text-white p-6 rounded-xl font-bold flex flex-col items-center justify-center gap-2 transition">
                    <i class="fa-solid fa-plus text-2xl"></i> Adicionar Produto
                </button>
                <button onclick="app.showSettingsModal()" class="bg-dark-700 hover:bg-dark-600 text-white p-6 rounded-xl font-bold flex flex-col items-center justify-center gap-2 border border-white/10 transition">
                    <i class="fa-solid fa-gear text-2xl"></i> Configura√ß√µes
                </button>
                <button onclick="app.logout()" class="bg-red-900/50 hover:bg-red-900 text-red-200 p-6 rounded-xl font-bold flex flex-col items-center justify-center gap-2 border border-red-500/20 transition">
                    <i class="fa-solid fa-right-from-bracket text-2xl"></i> Sair
                </button>
            </div>

            <div class="bg-dark-800 rounded-xl border border-white/5 overflow-hidden">
                <table class="w-full text-left border-collapse">
                    <thead class="bg-dark-700 text-gray-400 text-xs uppercase">
                        <tr>
                            <th class="p-4">Produto</th>
                            <th class="p-4">Pre√ßo</th>
                            <th class="p-4">Estoque</th>
                            <th class="p-4 text-right">A√ß√µes</th>
                        </tr>
                    </thead>
                    <tbody id="admin-product-list" class="divide-y divide-white/5 text-sm"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Modal Produto (Novo Campos) -->
    <div id="product-modal" class="fixed inset-0 z-[90] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm p-4">
        <div class="bg-dark-800 rounded-2xl w-full max-w-3xl max-h-[90vh] overflow-y-auto border border-white/10 p-6">
            <div class="flex justify-between mb-6">
                <h3 class="text-xl font-bold" id="modal-title">Produto</h3>
                <button onclick="app.closeModal('product-modal')" class="text-gray-500"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <form id="product-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="hidden" id="prod-id">
                
                <!-- B√°sico -->
                <div class="md:col-span-2">
                    <label class="text-xs text-gray-500">Nome do Modelo</label>
                    <input type="text" id="prod-name" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white" required>
                </div>

                <div>
                    <label class="text-xs text-gray-500">Pre√ßo (R$)</label>
                    <input type="number" step="0.01" id="prod-price" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white" required>
                </div>

                <div>
                    <label class="text-xs text-gray-500">Categoria</label>
                    <select id="prod-category" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white">
                        <option value="iPhone">iPhone</option>
                        <option value="Android">Android</option>
                        <option value="Acessorio">Acess√≥rio</option>
                    </select>
                </div>

                <!-- Detalhes T√©cnicos (Novos) -->
                <div>
                    <label class="text-xs text-gray-500">Condi√ß√£o</label>
                    <select id="prod-condition" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white">
                        <option value="Novo">Novo (Lacrado)</option>
                        <option value="Vitrine">Vitrine (Impec√°vel)</option>
                        <option value="Usado">Seminovo (Bom estado)</option>
                    </select>
                </div>

                <div>
                    <label class="text-xs text-gray-500">Armazenamento (GB)</label>
                    <input type="text" id="prod-storage" placeholder="Ex: 128GB" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white">
                </div>

                <div>
                    <label class="text-xs text-gray-500">Sa√∫de da Bateria (%)</label>
                    <input type="text" id="prod-battery" placeholder="Ex: 100% ou N/A" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white">
                </div>

                <div>
                    <label class="text-xs text-gray-500">Cor</label>
                    <input type="text" id="prod-color" placeholder="Ex: Azul Sierra" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white">
                </div>

                <!-- Imagem -->
                <div class="md:col-span-2 border-t border-white/5 pt-4">
                    <label class="text-xs text-gray-500 mb-2 block">Foto do Produto</label>
                    <div class="flex gap-4">
                        <div class="h-24 w-24 bg-black rounded-lg border border-dark-600 flex items-center justify-center overflow-hidden">
                            <img id="image-preview" src="" class="max-h-full max-w-full">
                        </div>
                        <div class="flex-1 space-y-2">
                            <input type="file" id="prod-image-file" class="text-sm text-gray-400 file:mr-4 file:py-2 file:px-4 file:rounded-full file:bg-brand-600 file:text-white file:border-0">
                            <input type="text" id="prod-image-url" placeholder="Ou cole URL da imagem" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-2 text-xs text-white">
                        </div>
                    </div>
                </div>

                <!-- Descri√ß√£o -->
                <div class="md:col-span-2">
                    <label class="text-xs text-gray-500">Descri√ß√£o Detalhada (Defeitos, acess√≥rios inclusos)</label>
                    <textarea id="prod-desc" rows="3" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white"></textarea>
                </div>

                <div class="md:col-span-2 pt-4">
                    <button type="submit" class="w-full bg-brand-600 text-white py-3 rounded-lg font-bold">Salvar Produto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Configura√ß√µes -->
    <div id="settings-modal" class="fixed inset-0 z-[90] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm">
        <div class="bg-dark-800 rounded-2xl p-6 max-w-md w-full border border-white/10">
            <h3 class="text-xl font-bold mb-4">Configurar Loja</h3>
            <form id="settings-form" class="space-y-4">
                <div>
                    <label class="text-xs text-gray-500">WhatsApp da Loja</label>
                    <input type="text" id="setting-phone" class="w-full bg-dark-900 border border-dark-600 rounded-lg p-3 text-white">
                </div>
                <button type="submit" class="w-full bg-brand-600 text-white py-3 rounded-lg font-bold">Salvar</button>
                <button type="button" onclick="app.closeModal('settings-modal')" class="w-full text-gray-500 py-2">Cancelar</button>
            </form>
        </div>
    </div>

    <!-- Bot√£o Flutuante -->
    <div onclick="app.contactWhatsApp()" class="fixed bottom-6 right-6 bg-[#25D366] hover:bg-[#20bd5a] cursor-pointer text-white h-14 w-14 rounded-full shadow-lg shadow-green-900/50 flex items-center justify-center z-40 transition hover:scale-110">
        <i class="fa-brands fa-whatsapp text-3xl"></i>
    </div>

    <!-- Toast -->
    <div id="toast" class="fixed top-20 right-4 bg-dark-800 border border-white/10 text-white px-6 py-4 rounded-xl shadow-2xl transition-all duration-300 translate-x-full z-[100] flex items-center gap-3">
        <i class="fa-solid fa-circle-check text-green-500"></i>
        <span id="toast-msg">Mensagem</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, setDoc, doc, deleteDoc, updateDoc, query, orderBy, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // CONFIGURA√á√ÉO FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyC_eJTAlkSBY6BMabDhD7PttC_rSOQ8wDY",
            authDomain: "chcell-263ec.firebaseapp.com",
            projectId: "chcell-263ec",
            storageBucket: "chcell-263ec.firebasestorage.app",
            messagingSenderId: "598254869331",
            appId: "1:598254869331:web:ca7b8c8c915712c2cd9fa6"
        };

        const appCheck = initializeApp(firebaseConfig);
        const auth = getAuth(appCheck);
        const db = getFirestore(appCheck);
        const productsCol = collection(db, "products");
        const settingsDoc = doc(db, "settings", "config");

        // ESTADO GLOBAL
        let state = {
            user: null,
            products: [],
            cart: [], // Array de produtos no carrinho
            phone: "5511999999999",
            editingId: null,
            currentImage: ''
        };

        // --- SISTEMA DE CARRINHO ---
        
        function addToCart(product) {
            state.cart.push(product);
            updateCartUI();
            showToast(`${product.name} adicionado!`);
            // Abre o carrinho automaticamente para feedback
            document.getElementById('cart-drawer').classList.remove('drawer-closed');
            document.getElementById('cart-drawer').classList.add('drawer-open');
            document.getElementById('cart-overlay').classList.remove('hidden');
        }

        function removeFromCart(index) {
            state.cart.splice(index, 1);
            updateCartUI();
        }

        function updateCartUI() {
            // Contador
            const countBadge = document.getElementById('cart-count');
            countBadge.innerText = state.cart.length;
            state.cart.length > 0 ? countBadge.classList.remove('hidden') : countBadge.classList.add('hidden');

            // Lista
            const list = document.getElementById('cart-items');
            const totalEl = document.getElementById('cart-total');
            
            if (state.cart.length === 0) {
                list.innerHTML = `
                    <div class="text-center py-10 text-gray-500">
                        <i class="fa-solid fa-cart-arrow-down text-4xl mb-3 opacity-30"></i>
                        <p>Seu carrinho est√° vazio.</p>
                    </div>`;
                totalEl.innerText = "R$ 0,00";
                return;
            }

            let total = 0;
            list.innerHTML = state.cart.map((p, index) => {
                total += p.price;
                return `
                    <div class="flex gap-3 bg-dark-700/50 p-3 rounded-lg border border-white/5">
                        <img src="${p.image}" class="w-16 h-16 object-contain bg-black rounded-md">
                        <div class="flex-1">
                            <h4 class="font-bold text-sm text-white line-clamp-1">${p.name}</h4>
                            <p class="text-xs text-gray-400">${p.condition} ‚Ä¢ ${p.storage || ''}</p>
                            <p class="text-brand-400 font-bold text-sm mt-1">R$ ${p.price.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</p>
                        </div>
                        <button onclick="app.removeFromCart(${index})" class="text-red-400 hover:text-red-300 self-start"><i class="fa-solid fa-trash-can"></i></button>
                    </div>
                `;
            }).join('');
            
            totalEl.innerText = `R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
            // Atualiza tamb√©m o total do modal de checkout
            document.getElementById('checkout-total').innerText = totalEl.innerText;
        }

        // --- RENDERIZA√á√ÉO DE PRODUTOS ---

        function renderProducts(filter = 'all', searchTerm = '') {
            const grid = document.getElementById('product-grid');
            
            let filtered = state.products;
            
            // Filtro Categoria
            if (filter !== 'all') {
                filtered = filtered.filter(p => p.category === filter);
            }
            
            // Filtro Busca
            if (searchTerm) {
                const term = searchTerm.toLowerCase();
                filtered = filtered.filter(p => p.name.toLowerCase().includes(term));
            }

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500">Nenhum produto encontrado.</div>`;
                return;
            }

            grid.innerHTML = filtered.map(p => {
                // Badge Logic
                let badgeClass = 'badge-usado';
                if(p.condition === 'Novo') badgeClass = 'badge-novo';
                if(p.condition === 'Vitrine') badgeClass = 'badge-vitrine';

                return `
                <div class="card-glass rounded-2xl overflow-hidden flex flex-col group hover-lift relative h-full">
                    <div class="absolute top-3 left-3 z-10 flex flex-col gap-1 pointer-events-none">
                        <span class="${badgeClass} text-[10px] font-bold px-2 py-1 rounded-md uppercase tracking-wide shadow-sm">${p.condition}</span>
                        ${p.battery ? `<span class="bg-black/70 text-white text-[10px] px-2 py-1 rounded-md border border-white/10"><i class="fa-solid fa-battery-half mr-1"></i>${p.battery}</span>` : ''}
                    </div>
                    
                    <div onclick="app.openQuickView('${p.id}')" class="h-64 p-6 bg-gradient-to-b from-dark-800 to-dark-900 flex items-center justify-center relative overflow-hidden cursor-pointer group-image">
                        <img src="${p.image}" class="max-h-full max-w-full object-contain transition-transform duration-500 group-hover:scale-110 drop-shadow-xl z-0">
                        
                        <div class="absolute inset-0 bg-black/20 opacity-0 group-hover:opacity-100 transition flex items-center justify-center backdrop-blur-[2px]">
                            <span class="bg-white/10 border border-white/20 text-white px-4 py-2 rounded-full text-sm font-bold backdrop-blur-md shadow-xl flex items-center gap-2">
                                <i class="fa-regular fa-eye"></i> Ver Detalhes
                            </span>
                        </div>
                    </div>
                    
                    <div class="p-5 flex-1 flex flex-col border-t border-white/5 bg-dark-800">
                        <div class="mb-2">
                            <h3 class="text-lg font-bold text-white leading-tight mb-1 cursor-pointer hover:text-brand-400 transition" onclick="app.openQuickView('${p.id}')">${p.name}</h3>
                            <div class="text-xs text-gray-400 flex gap-2 items-center mb-3">
                                <span><i class="fa-solid fa-memory mr-1"></i>${p.storage || 'N/A'}</span>
                                ${p.color ? `<span><i class="fa-solid fa-palette mr-1"></i>${p.color}</span>` : ''}
                            </div>
                        </div>
                        
                        <div class="mt-auto pt-3 border-t border-white/5">
                            <p class="text-[10px] text-gray-500 mb-0.5">√Ä vista no Pix</p>
                            <div class="flex items-center justify-between">
                                <span class="text-xl font-bold text-brand-400">R$ ${p.price.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                                <button onclick="app.addToCartById('${p.id}')" class="bg-white text-black hover:bg-brand-500 hover:text-white h-10 w-10 rounded-full flex items-center justify-center transition shadow-lg">
                                    <i class="fa-solid fa-plus"></i>
                                </button>
                            </div>
                            <p class="text-[10px] text-gray-500 mt-1">ou 12x de R$ ${(p.price * 1.15 / 12).toLocaleString('pt-BR', {maximumFractionDigits: 2})}</p>
                        </div>
                    </div>
                </div>`;
            }).join('');
        }

        // --- APP EXPORTS ---
        window.app = {
            // Cart
            toggleCart: () => {
                const drawer = document.getElementById('cart-drawer');
                const overlay = document.getElementById('cart-overlay');
                if (drawer.classList.contains('drawer-closed')) {
                    drawer.classList.remove('drawer-closed');
                    drawer.classList.add('drawer-open');
                    overlay.classList.remove('hidden');
                } else {
                    drawer.classList.add('drawer-closed');
                    drawer.classList.remove('drawer-open');
                    overlay.classList.add('hidden');
                }
            },
            addToCartById: (id) => {
                const prod = state.products.find(p => p.id === id);
                if(prod) addToCart(prod);
            },
            removeFromCart,

            // Quick View Logic
            openQuickView: (id) => {
                const p = state.products.find(x => x.id === id);
                if(!p) return;

                document.getElementById('qv-image').src = p.image;
                document.getElementById('qv-name').innerText = p.name;
                document.getElementById('qv-desc').innerText = p.description || "Sem descri√ß√£o dispon√≠vel.";
                document.getElementById('qv-price').innerText = `R$ ${p.price.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`;
                
                // Badge Logic
                const badgeEl = document.getElementById('qv-badge');
                badgeEl.className = 'text-[10px] font-bold px-2 py-1 rounded-md uppercase tracking-wide shadow-sm mb-2 inline-block text-white';
                if(p.condition === 'Novo') badgeEl.classList.add('bg-green-500');
                else if(p.condition === 'Vitrine') badgeEl.classList.add('bg-blue-500');
                else badgeEl.classList.add('bg-yellow-500', 'text-black');
                badgeEl.innerText = p.condition;

                // Tech Specs
                document.getElementById('qv-storage').innerHTML = `<i class="fa-solid fa-memory mr-1 text-gray-500"></i> ${p.storage || 'N/A'}`;
                document.getElementById('qv-color').innerHTML = p.color ? `<i class="fa-solid fa-palette mr-1 text-gray-500"></i> ${p.color}` : '';
                document.getElementById('qv-battery').innerHTML = p.battery ? `<i class="fa-solid fa-battery-half mr-1 text-gray-500"></i> ${p.battery}` : '';
                
                // Button Add
                const btn = document.getElementById('qv-btn-add');
                btn.onclick = () => {
                    app.addToCartById(id);
                    app.closeModal('quickview-modal');
                };

                document.getElementById('quickview-modal').classList.remove('hidden');
            },

            // Navigation
            showHome: () => {
                document.getElementById('admin-panel').classList.add('hidden');
                window.scrollTo(0,0);
            },
            
            // Filtros
            filterProducts: (cat) => renderProducts(cat, document.getElementById('search-input').value),
            searchProducts: (val) => renderProducts('all', val),

            // Checkout Logic
            goToCheckout: () => {
                if(state.cart.length === 0) return showToast("Carrinho vazio!", true);
                app.toggleCart(); // fecha drawer
                
                // Popula resumo
                const summaryEl = document.getElementById('checkout-summary');
                summaryEl.innerHTML = state.cart.map(p => `‚Ä¢ ${p.name} (${p.condition}) - R$ ${p.price}`).join('<br>');
                
                document.getElementById('checkout-modal').classList.remove('hidden');
            },
            
            toggleAddress: (show) => {
                const fields = document.getElementById('address-fields');
                const inputs = fields.querySelectorAll('input');
                if(show) {
                    fields.classList.remove('hidden');
                    inputs.forEach(i => i.required = true);
                } else {
                    fields.classList.add('hidden');
                    inputs.forEach(i => i.required = false);
                }
            },

            // Modals Generics
            closeModal: (id) => document.getElementById(id).classList.add('hidden'),
            toggleAdminModal: () => {
                if (state.user) {
                    document.getElementById('admin-panel').classList.remove('hidden');
                    updateAdminStats();
                } else {
                    document.getElementById('login-modal').classList.remove('hidden');
                }
            },
            hideAdminPanel: () => document.getElementById('admin-panel').classList.add('hidden'),

            // Contact
            contactWhatsApp: (msg = "") => {
                const text = msg || "Ol√°! Vim pelo site da CH Celulares.";
                window.open(`https://wa.me/${state.phone}?text=${encodeURIComponent(text)}`, '_blank');
            },

            // CRUD UI
            showAddProductModal: () => {
                state.editingId = null;
                state.currentImage = '';
                document.getElementById('modal-title').innerText = "Novo Produto";
                document.getElementById('product-form').reset();
                document.getElementById('image-preview').src = '';
                document.getElementById('product-modal').classList.remove('hidden');
            },
            showSettingsModal: () => {
                document.getElementById('setting-phone').value = state.phone;
                document.getElementById('settings-modal').classList.remove('hidden');
            },
            editProduct: (id) => {
                const prod = state.products.find(p => p.id === id);
                if (!prod) return;
                state.editingId = id;
                state.currentImage = prod.image;
                
                // Fill fields
                document.getElementById('prod-name').value = prod.name;
                document.getElementById('prod-price').value = prod.price;
                document.getElementById('prod-category').value = prod.category || 'iPhone';
                document.getElementById('prod-condition').value = prod.condition || 'Usado';
                document.getElementById('prod-storage').value = prod.storage || '';
                document.getElementById('prod-battery').value = prod.battery || '';
                document.getElementById('prod-color').value = prod.color || '';
                document.getElementById('prod-desc').value = prod.description || '';
                document.getElementById('prod-image-url').value = prod.image.startsWith('data') ? '' : prod.image;
                document.getElementById('image-preview').src = prod.image;
                
                document.getElementById('modal-title').innerText = "Editar Produto";
                document.getElementById('product-modal').classList.remove('hidden');
            },
            deleteProduct: async (id) => {
                if(confirm('Tem certeza?')) await deleteDoc(doc(db, "products", id));
            },
            logout: () => signOut(auth)
        };

        // --- LOGIC: CHECKOUT WHATSAPP ---
        document.getElementById('checkout-form').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const name = document.getElementById('cust-name').value;
            const phone = document.getElementById('cust-phone').value;
            const method = document.getElementById('cust-payment').value;
            const deliveryType = document.querySelector('input[name="delivery"]:checked').value;
            
            let addressText = "Retirada na Loja";
            if(deliveryType === 'entrega') {
                addressText = `Entrega em: ${document.getElementById('cust-address').value}, ${document.getElementById('cust-city').value}`;
            }

            // Constroi Mensagem
            let msg = `*NOVO PEDIDO - SITE CH CELULARES*\n`;
            msg += `--------------------------------\n`;
            msg += `üë§ *Cliente:* ${name}\n`;
            msg += `üìû *Contato:* ${phone}\n`;
            msg += `üì¶ *Entrega:* ${addressText}\n`;
            msg += `üí≥ *Pagamento:* ${method}\n`;
            msg += `--------------------------------\n`;
            msg += `*ITENS DO PEDIDO:*\n`;
            
            let total = 0;
            state.cart.forEach(p => {
                msg += `üì± 1x ${p.name} (${p.condition}, ${p.storage || ''}) - R$ ${p.price}\n`;
                total += p.price;
            });
            
            msg += `--------------------------------\n`;
            msg += `üí∞ *TOTAL A PAGAR:* R$ ${total.toLocaleString('pt-BR', {minimumFractionDigits: 2})}\n`;
            msg += `\n_Aguardo confirma√ß√£o para pagamento._`;

            // Envia
            const url = `https://wa.me/${state.phone}?text=${encodeURIComponent(msg)}`;
            window.open(url, '_blank');
            
            // Limpa
            state.cart = [];
            updateCartUI();
            app.closeModal('checkout-modal');
        });

        // --- AUTH & DATA LISTENERS ---
        onAuthStateChanged(auth, (user) => {
            state.user = user;
            if(user) document.getElementById('adminBtn').classList.remove('hidden');
        });

        // Load Products
        onSnapshot(query(productsCol, orderBy("name")), (snap) => {
            state.products = snap.docs.map(d => ({id: d.id, ...d.data()}));
            renderProducts();
            document.getElementById('loading-spinner').classList.add('hidden');
            if(!document.getElementById('admin-panel').classList.contains('hidden')) updateAdminTable();
        });

        // Load Settings
        onSnapshot(settingsDoc, (snap) => {
            if(snap.exists()) state.phone = snap.data().whatsapp || "5511999999999";
        });

        // --- ADMIN FORMS ---
        document.getElementById('login-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await signInWithEmailAndPassword(auth, document.getElementById('email').value, document.getElementById('password').value);
                document.getElementById('login-modal').classList.add('hidden');
                app.toggleAdminModal();
            } catch (err) {
                document.getElementById('login-error').innerText = "Credenciais inv√°lidas.";
                document.getElementById('login-error').classList.remove('hidden');
            }
        });

        // Image Handling
        document.getElementById('prod-image-file').addEventListener('change', async function() {
            if(this.files[0]) {
                const reader = new FileReader();
                reader.readAsDataURL(this.files[0]);
                reader.onload = function(e) {
                    // Resize Logic Basic
                    const img = new Image();
                    img.src = e.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');
                        const MAX_WIDTH = 500; 
                        const scale = MAX_WIDTH / img.width;
                        canvas.width = MAX_WIDTH;
                        canvas.height = img.height * scale;
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        state.currentImage = canvas.toDataURL('image/jpeg', 0.7);
                        document.getElementById('image-preview').src = state.currentImage;
                    }
                }
            }
        });
        
        document.getElementById('prod-image-url').addEventListener('input', function() {
            if(this.value) {
                state.currentImage = this.value;
                document.getElementById('image-preview').src = this.value;
            }
        });

        // Save Product
        document.getElementById('product-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = "Salvando...";
            
            const data = {
                name: document.getElementById('prod-name').value,
                price: parseFloat(document.getElementById('prod-price').value),
                category: document.getElementById('prod-category').value,
                condition: document.getElementById('prod-condition').value,
                storage: document.getElementById('prod-storage').value,
                battery: document.getElementById('prod-battery').value,
                color: document.getElementById('prod-color').value,
                description: document.getElementById('prod-desc').value,
                image: state.currentImage || 'https://via.placeholder.com/300?text=No+Img',
                updatedAt: new Date()
            };

            try {
                if(state.editingId) {
                    await updateDoc(doc(db, "products", state.editingId), data);
                    showToast("Produto atualizado!");
                } else {
                    data.createdAt = new Date();
                    await addDoc(productsCol, data);
                    showToast("Produto criado!");
                }
                app.closeModal('product-modal');
            } catch(err) {
                console.error(err);
                alert("Erro ao salvar. Verifique se voc√™ est√° logado.");
            }
            btn.innerText = "Salvar Produto";
        });

        // Settings Save
        document.getElementById('settings-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const phone = document.getElementById('setting-phone').value.replace(/\D/g,'');
            await setDoc(settingsDoc, { whatsapp: phone }, { merge: true });
            showToast("Configura√ß√£o salva!");
            app.closeModal('settings-modal');
        });

        // Helpers
        function showToast(msg, isError = false) {
            const t = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            t.classList.remove('translate-x-full');
            setTimeout(() => t.classList.add('translate-x-full'), 3000);
        }

        function updateAdminStats() {
            document.getElementById('admin-total-prods').innerText = state.products.length;
            updateAdminTable();
        }

        function updateAdminTable() {
            const tbody = document.getElementById('admin-product-list');
            tbody.innerHTML = state.products.map(p => `
                <tr class="hover:bg-dark-700/50">
                    <td class="p-4 flex items-center gap-3">
                        <img src="${p.image}" class="w-10 h-10 rounded object-cover">
                        <div>
                            <div class="font-bold text-white">${p.name}</div>
                            <div class="text-xs text-gray-500">${p.category} ‚Ä¢ ${p.condition}</div>
                        </div>
                    </td>
                    <td class="p-4 text-gray-300">R$ ${p.price}</td>
                    <td class="p-4"><span class="bg-green-500/10 text-green-500 px-2 py-1 rounded text-xs">Em Estoque</span></td>
                    <td class="p-4 text-right space-x-2">
                        <button onclick="app.editProduct('${p.id}')" class="text-blue-400 hover:text-white"><i class="fa-solid fa-pen"></i></button>
                        <button onclick="app.deleteProduct('${p.id}')" class="text-red-400 hover:text-white"><i class="fa-solid fa-trash"></i></button>
                    </td>
                </tr>
            `).join('');
        }
    </script>
</body>
</html>
